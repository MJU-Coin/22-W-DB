# CHAPTER 07 정규화

# 정규화

## 이상현상 anomoly

### 개념

아래 현상이 발생하는 것

- 삽입 시, 특정 속성에 해당하는 값이 없어 NULL값이 입력: 삽입이상 insertion anomaly
- 삭제 시, 같이 저장된 다른 정보까지 연쇄삭제 현상: 삭제이상deletion anomaly
- 수정 시, 중복된 데이터의 일부만 수정되어 데이터의 일관성이 훼손(inconsistency)되는 현상 :수정이상update anomaly

<br/>

## 함수 종속성 functionally dependency

### 개념

- 어떤 속성 A의 값을 알면 다른 속성 B의 값이 유일하게 정해지는 의존관계<br/>
= 속성 B는 속성 A에 종속한다 functionally dependent<br/>
= 속성 A는 속성 B를 함수적으로 결정한다 determine<br/>
= (표기)A->B<br/>
= A는 B의 결정자determinant, B는 종속속성 dependent attribute<br/>
- 함수 종속성(FD, functionally dependency, 함수적 종속성)

### 표기법 functionally dependency diagram

- 함수종속성 다이어그램 fuctional dependency diagram)
    - 릴레이션의 속성: 직사각형
    - 속성 간의 함수 종속성: 화살표
    - 복합 속성: 직사각형으로 묶어 표기

### 규칙 functionally dependency rule

- 부분 집합(subset) 규칙: If Y ⊆ X, then X → Y
- 증가(augmentation) 규칙 : If X → Y then XZ → YZ
- 이행(transitivity) 규칙 : If X → Y and Y → Z then, X → Z
- 결합 규칙(union) : If X → Y and X → Z then, X → YZ
- 분해(decomposition) 규칙 : If X → YZ, then X → Y and X → Z
- 유사이행(pseudotransitivity) 규칙: If X -> Y and WY → Z, then WX → Z

### 결정자

결정자 관련 **기본키**

- 릴레이션 R(K, A1, A2, A3, …An)에서 K가 기본키이면, K→R이 성립하므로 기본키는 릴레이션의 모든 속성에 대해 결정자(determinant)

결정자 관련 **이상현상 발생 원인**

- 기본키가 아니면서 결정자인 속성(비후보키 결정자 속성)이 있을 때 발생
→ (비후보키 결정자 속성+비후보키 결정자 속성이 결정하는 속성)이 하나의 릴레이션을 갖도록 분해
    - 부분 릴레이션의 결정자는 원래 릴레이션에 속성으로 존재해야 관계를 형성할 수 있음

<br/>

## 정규화nomalization

### 개념

- 이상현상이 발생하는 테이블을 분해하여 이상현상을 없애는 과정
- 이상현상을 일으키는 함수 종속성의 유형에 따라 정규형의 개념으로 구분하며, 정규형이 높을수록 이상현상은 줄어듦

### 특징

- BCNF까지 정규화하면 실제적인 이상현상이 없어지므로 보통 이 단계까지 진행
- 원자값을 만족하지 않는 속성을 가진 상태에서 원자값을 만족하는 형태로 정규화된 경우 제 1정규형이 될 수도있지만, 제 2정규형, 제 3정규형이 될 수도 있음 → 정규화를 통해 정규형이 단계별로 달성되는 것이 아니라 만족하는 정규형에 속하는 것

### 제 1 정규형

- 조건: 릴레이션 R의 모든 속성 값이 원자값을 가진다

- 분해 전<br/> 속성값이 원자 값을 갖도록 분해한다.
ex) 속성 값이 원자 값이 아닌 경우
    
    
    | 이름 | 취미 |
    | --- | --- |
    | 김영환 | 영화, 음악 |
    | 고건 | 음악 |
    | 김민 | 쇼핑, 게임, 영화 |

- 분해 후
    
    
    | 이름 | 취미 |
    | --- | --- |
    | 김영환 | 영화 |
    | 김영환 | 음악 |
    | 고건 | 음악 |
    | 김민 | 쇼핑 |
    | 김민 | 게임 |
    | 김민 | 영화 |

### 제 2 정규형

- 조건: 릴레이션 R이 제 1정규형이고 기본키가 아닌 속성이 완전 함수 종속이다

<aside>
💡 완전 함수 종속
A와 B가 릴레이션 R의 속성이고 A→B 종속성이 성립할 때, B가 A의 속성 전체에 함수 종속하고 부분 집합 속성에 함수 종속하지 않는 경우

</aside>

- 릴레이션의 기본키가 복합키인 경우, 복합키의 일부가 다른 속성의 결정자인지 여부를 판단하는 것
- 불완전 함수 종속(부분 함수 종속, partial functional dependency) → 기본키의 일부를 제거해도 종속성이 여전히 성립하는 경우
- 불완전 함수 종속이 없도록 릴레이션 분리
ex) 강좌이름이 강의실을 종속하는 경우 <br/>
수강강좌(학생번호, 강좌이름, 강의실, 성적) → 수강(학생번호, 강좌이름, 성적), 강의실(강좌이름, 강의실)

### 제 3 정규형

- 조건: 릴레이션 R이 제 2정규형이고 기본키가 아닌 속성이 기본키에 비이행적non-transitive으로 종속하는 경우(직접 종속)
    
    <aside>
    💡 이행적 종속<br/>
    A→B, B→C가 성립 할 때 A→C가 성립되는 함수 종속성
    
    </aside>
    
- 속성들이 이행적transitive으로 종속되어있는지 여부를 판단하는 것
- 이행적 종속이 없도록 분해
ex) 계절학기 릴레이션의 속성(강좌이름)이 계절학기 릴레이션 다른 속성(수강료)를 종속하는 경우<br/>
계절학기(학생번호, 강좌이름, 수강료) → 계절수강(학생번호, 강좌이름), 수강료(강좌이름, 수강료)

### 제 4 정규형

- 조건: 릴레이션 R이 제 3정규형이고 다치종속성multivalued dependency이 없는 경우

### 제 5 정규형

- 조건: 릴레이션 R이 제 4정규형이고 조인종속성join dependency이 없는 경우

### BCNF 정규형

- boyce codd normal form 정규형 → 릴레이션 R에서 함수 종속성 X→Y가 성립할 때 모든 결정자 X가 후보키인 정규형
- ex)결정자이지만 후보키가 아닌 속성(교수)이 존재
특강수강(학생번호, 특강이름, 교수) → 특강신청(학생번호, 교수), 특강 교수(특강 이름, 교수)

### 무손실 분해

- 정의: 무손실 분해lossless-join decomposition → 릴레이션 R을 R1과 R2로 분해할 때, R1**⋈**R2=R를 만족하는 경우
- 조건: R1 **∩** R2 → R1의 key | R1 **∩** R2 → R2의 key 만족
- 분해된 릴레이션 간의 relationship을 유지하기 위해 분해된 릴레이션에 공통 속성을 한 개 이상 존재해야함
- 공통 속성은 분해된 릴레이션을 다시 원래의 릴레이션으로 join할때 사용
- 조건을 만족하지 않고 key가 아닌 일반 속성을 공통속성을 갖는 경우 손실loss 분해 됨