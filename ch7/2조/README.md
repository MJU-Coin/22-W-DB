# Chapter 7 - 정규화

## 이상현상 (Anomaly)

- **이상현상**: table에 tuple을 삽입할 때 부득이하게 NULL 값이 입력되거나, 삭제 시 연쇄삭제 현상이 발생하거나, 수정 시 데이터의 일관성이 훼손되는 현상

- **삭제 이상** 
: tuple 삭제 시 같이 저장된 다른 정보까지 연쇄적으로 삭제되는 현상
- **삽입 이상**
: tuple 삽입 시 특정 속성에 해당하는 값이 없어 NULL 값을 입력해야 하는 현상
- **수정 이상**
: tuple 수정 시 중복된 데이터의 일부만 수정되어 데이터의 불일치 문제가 일어나는 현상

## 함수 종속성

- **Nomalization (정규화)**: anomaly가 발생하는 table을 수정해 정상으로 만드는 과정
    - 정규화를 위해서는 table을 분석해 pk와 함수 종속성을 파악해야 함

- **종속 관계**
    - 어떤 속성 A의 값을 알면 다른 속성 B의 값이 유일하게 정해지는 의존 관계
    ⇒ 속성 B는 속성 A에 종속한다 **(dependent)**
    ⇒ 속성 A는 속성 B를 결정한다 **(determine)
    ⇒ A → B** 로 표기
    - 종속성을 판단할 때에는 attribute가 갖는 의미를 가지고 판단해야 함

- **함수 종속성**
    - ‘학생번호 → 이름’ 와 같이 왼쪽 속성의 모든 값에 대해 오른쪽 속성의 값이 **유일하게 결정**될 때 **‘함수적으로 종속한다 (funtionally dependent)’** 고 말함
    - table의 함수 종속성을 파악하기 위해서는 우선 pk를 찾아야 함
        - table R(K,A,B)가 존재하고 K가 pk라고 하면, K→A, K→B가 성립

- **anomaly와 결정자**
    - anomaly는 한 개의 relation에 두 개 이상의 정보가 포함되어 있을 때 나타남
    
    Ex) table **학생수강성적(학생번호, 학생이름, 주소, 학과, 학과사무실, 강좌이름, 강의실, 성적)**
    에서는 학생 정보와 강좌 정보가 한 table에 포함되어 있으므로 이상현상이 나타나게 됨
    
    - **분해**
        - **1) 학생수강성적에서 (강좌이름, 강의실) 분리**
        학생수강성적1(학생번호, 학생이름, 주소, 학과, 강좌이름, 성적, 학과사무실)
        강의실(강좌이름, 강의실)
        - **2) 학생수강성적1에서 (학생번호, 강좌이름, 성적) 분리**
        학생학과(학생번호, 학생이름, 학과, 주소, 학과사무실)
        학생성적(학생번호, 강좌이름, 성적)
        강의실(강좌이름, 강의실)
        - **3) 학생학과에서 (학과, 학과사무실) 분리**
        학생(학생번호, 학생이름, 학과, 주소)
        학과(학과, 학과사무실)
        학생성적(학생번호, 강좌이름, 성적)
        강의실(강좌이름, 강의실)
        
        **⇒ anomaly가 더이상 발생하지 않게 됨**
        

## 정규화

- **normalization (정규화)**: anomaly가 발생하는 relation을 분해해 anomaly를 없애는 과정
- relation은 normal form (정규형)이라는 개념으로 구분하며, 단계가 높을수록 anomaly가 줄어듬

- **1NF(Normal form)**
: 관계 데이터베이스에서 릴레이션의 속성 값은 반드시 원자값이어야 함

Ex) 고객취미(이름, (취미)) 일 때
    
    
    | 이름 | 취미 |
    | --- | --- |
    | 신현진 | 영화,음악 |
    | 김세빈 | 쇼핑, 게임 |
    
    고객취미 (이름, 취미) 로 변환
    
    | 이름 | 취미 |
    | --- | --- |
    | 신현진 | 영화 |
    | 신현진 | 음악 |
    | 김세빈 | 쇼핑 |
    | 김세빈 | 게임 |
    
- **2NF**
: 1NF여야 하고, 완전 함수 종속일 때 (= 부분 함수 종속이 아닐 때)
    - **full functional dependency (완전 함수 종속)**: R(A,B)이고 A→B일때 B가 A의 속성 전체에 함수 종속하고 부분 집합 속성에 함수종속하지 않을 경우
    - **partial functional dependenty (부분 함수 종속)**
    Ex) (A1, A2) → B에서 A2를 제거하고 A1→B가 성립할 때
    
    Ex) 수강강좌(학생번호, 강좌이름, 강의실, 성적)
    
    성적의 특정한 값을 알기 위해서는 학생번호+강좌이름이 필요함. (ex) 501번의 db 성적은 3.5)
    
    특정 강좌의 강의실은 강좌이름만 알면 알 수 있음. 
    (ex) db 강의실은 공학관 110)
    
    수강(학생번호, 강좌이름, 성적)
    강의실 (강좌이름, 강의실) 로 변환
    
- **3NF**
:2NF여야하고, pk가 아닌 속성이 기본키에 비이행적으로 종속할 때
    - **이행적 종속**
    A→B (A가 B를 결정하고)
    B→C (B가 C를 결정할때)
    A→C (A가 C도 결정해줌)
    
    Ex)
    ID → 등급
    등급 → 할인율
    ID → 할인율
    
- **BCNF**
: relation R에서 X→Y일 때 모든 결정자 X가 후보키일때
    
- **무손실 분해**
: relation R을 R1 과 R2로 분해할 때, R1과 R2를 JOIN한 것이 R이면 무손실분해라고 함
    - R1 교집합 R2 → R1 / R2 교집합 R1 → R2를 만족해야 함
    
- **정규화** **정리**
    - 정규화 과정은 1NF → 2NF → 3NF → BCNF → 4NF → 5NF 까지 있는데, BCNF까지 정규화하면 실제적인 anomaly가 없어지기 때문에 보통은 BCNF까지만 진행함